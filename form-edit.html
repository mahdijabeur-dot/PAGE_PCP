<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Modifier PCP</title></head>

<body>

<script>
const PAGE = `
<h2>Modifier un PCP</h2>

<form id="editForm" class="mt-3">

    <label>Processus</label>
    <input id="p1" class="form-control mb-3" name="processus">

    <label>Description</label>
    <textarea id="p2" class="form-control mb-3" name="description"></textarea>

    <label>Fréquence</label>
    <input id="p3" class="form-control mb-3" name="frequence">

    <button class="btn btn-success">Enregistrer</button>
</form>
`;

const SCRIPT = `
const id = new URLSearchParams(location.search).get("id");

async function load(){
    let r = await fetch("api/pcp.php?action=get&id="+id);
    let p = await r.json();

    p1.value = p.processus;
    p2.value = p.description;
    p3.value = p.frequence;
}

document.getElementById("editForm").onsubmit = async(e)=>{
    e.preventDefault();
    const data = new FormData(e.target);

    await fetch("api/pcp.php?action=update&id="+id,{
        method:"POST",
        body:data
    });

    alert("PCP modifié !");
    window.location="table-view.html";
};

load();
`;
</script>

<script>
window.onload=async()=>{
    let layout=await fetch("layout.html").then(r=>r.text());
    document.open();
    document.write(layout
        .replace("{{title}}","Modifier PCP")
        .replace("{{content}}", PAGE)
        .replace("{{scripts}}","<script>"+SCRIPT+"</script>")
    );
    document.close();
};
</script>

</body>
</html>
