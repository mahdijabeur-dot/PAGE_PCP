<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste PCP</title>
</head>

<body>

<script>
const PAGE = `
    <h2 class="mb-4">Liste des PCP</h2>

    <a href="form-create.html" class="btn btn-primary mb-3">+ Ajouter un PCP</a>

    <table id="pcpTable" class="table table-striped" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Processus</th>
                <th>Description</th>
                <th>Fr√©quence</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
`;

const SCRIPT = `
$(document).ready(function(){
    $('#pcpTable').DataTable({
        ajax: {
            url: 'api/pcp.php?action=list',
            dataSrc: ''
        },
        columns: [
            { data: 'id' },
            { data: 'processus' },
            { data: 'description' },
            { data: 'frequence' },
            {
                data: 'id',
                render: function(id){
                    return \`
                        <a href="form-edit.html?id=\${id}" class="btn btn-sm btn-warning">Modifier</a>
                        <button onclick="deletePCP(\${id})" class="btn btn-sm btn-danger">Supprimer</button>
                    \`;
                }
            }
        ]
    });
});

function deletePCP(id){
    if(!confirm("Supprimer ce PCP ?")) return;
    fetch("api/pcp.php?action=delete&id="+id)
        .then(()=>location.reload());
}
`;
</script>

<script>
window.onload = async () => {
    let layout = await fetch("layout.html").then(r=>r.text());
    document.open();
    document.write(layout
        .replace("{{title}}","Liste PCP")
        .replace("{{content}}", PAGE)
        .replace("{{scripts}}", `<script>${SCRIPT}</script>`)
    );
    document.close();
};
</script>

</body>
</html>
